---
image: registry.gitlab.com/lsm5/rpm-builder:latest

before_script:
     - cd ~
     - openssl enc -aes-256-cbc -pbkdf2 -d -in .centos.cert.enc -out .centos.cert -pass pass:$DECRYPTION_PASSPHRASE
     - openssl enc -aes-256-cbc -pbkdf2 -d -in .centos-server-ca.cert.enc -out .centos-server-ca.cert -pass pass:$DECRYPTION_PASSPHRASE
     - cd ~/.ssh
     - openssl enc -aes-256-cbc -pbkdf2 -d -in id_rsa.enc -out id_rsa -pass pass:$DECRYPTION_PASSPHRASE
     - chmod 600 id_rsa
     - echo $FEDORA_KRB_PASSWORD | kinit lsm5@FEDORAPROJECT.ORG
     - mkdir -p ~/repositories/pkgs
     - cd ~/repositories/rpm-builder
     - git fetch --all
     - git checkout f30
     - git pull

stages:
     - f30
     - f29

buildah-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p buildah

container-selinux-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p container-selinux

containernetworking-plugins-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p containernetworking-plugins

fuse-overlayfs-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p fuse-overlayfs

podman-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p podman

skopeo-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p skopeo

slirp4netns-f30:
     stage: f30
     script:
          - bash builder.sh -k f30 -t tagged -p slirp4netns

buildah-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p buildah

container-selinuxi-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p container-selinux

containernetworking-plugins-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p containernetworking-plugins

fuse-overlayfs-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p fuse-overlayfs

podman-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p podman

skopeo-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p skopeo

slirp4netns-f29:
     stage: f29
     script:
          - bash builder.sh -k f29 -t tagged -p slirp4netns
